<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="Site keywords here">
    <meta name="description" content="">
    <meta name='copyright' content=''>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Title -->
    <title>News Feed - Posy Mental Health</title>

    <!-- Favicon -->
    <link rel="icon" href="img/favicon.png">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">

    <!-- Essential CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/icofont.css">
    <link rel="stylesheet" href="css/slicknav.min.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <style>
        .news-container {
            max-width: 1200px;
            margin: 50px auto;
            padding: 0 15px;
        }
        
        .article-card {
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            background: #fff;
            transition: all 0.3s ease;
            border-left: 4px solid #2074d4;
        }
        
        .article-card:hover {
            transform: translateY(-5px);
        }
        
        .article-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
        }
        
        .article-content {
            padding: 20px;
            height: 200px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .article-meta {
            color: #2074d4;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .article-text {
            color: #444;
            line-height: 1.6;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
        }
        
        .featured-post .article-content {
            height: 250px;
        }
        
        .featured-post .article-text {
            -webkit-line-clamp: 8;
        }
        /* Featured post styles */
        
        .featured-post {
            width: 95%;
            margin-bottom: 40px;
        }
        
        .featured-post .article-image {
            height: 400px;
        }
        /* Regular posts grid */
        
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 30px;
        }
        /* Right column styles */
        
        .search-container {
            margin-bottom: 30px;
            position: relative;
            display: flex;
            gap: 10px;
        }
        
        .clear-search {
            padding: 0 15px;
            background: #2074d4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .clear-search:hover {
            background-color: #1861b3;
        }
        
        .clear-search:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .search-input {
            width: 100%;
            padding: 12px;
            border: 10px solid #ddd;
            border-radius: 5px;
            border-width: 3px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #2074d4;
            border-width: 3px;
            border-radius: 5px;
            box-shadow: 0 0 5px rgba(32, 116, 212, 0.3);
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: none;
        }
        
        .search-results.active {
            display: block;
        }
        
        .search-result-item {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        
        .search-result-item:hover {
            background: rgba(32, 116, 212, 0.1);
            color: #2074d4;
        }
        
        .search-result-item:last-child {
            border-bottom: none;
        }
        
        .search-result-title {
            font-weight: 500;
            color: #333;
            margin-bottom: 4px;
        }
        
        .search-result-meta {
            font-size: 0.8em;
            color: #666;
        }
        
        .search-result-item:hover .search-result-title {
            color: #2074d4;
        }
        
        .sidebar-box {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-box h3 {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2074d4;
            color: #2074d4;
            font-size: 1.2em;
        }
        
        .category-list,
        .recent-post-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .category-list li,
        .recent-post-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        
        .category-list li:hover,
        .recent-post-list li:hover {
            padding-left: 5px;
            color: #2074d4;
            background-color: rgba(32, 116, 212, 0.1);
        }
        
        .category-list li:last-child,
        .recent-post-list li:last-child {
            border-bottom: none;
        }
        
        .no-posts {
            text-align: center;
            padding: 40px;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
        }
        
        body {
            background-color: #f8f9fa;
        }
        
        .error-message {
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        
        .error-message h3 {
            margin-top: 0;
            color: inherit;
        }
        /* Pagination Styles */
        
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 30px 0;
            gap: 10px;
        }
        
        .pagination-button {
            padding: 8px 16px;
            background: #fff;
            border: 2px solid #2074d4;
            border-radius: 4px;
            color: #2074d4;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination-button:hover {
            background: #2074d4;
            color: #fff;
        }
        
        .pagination-button:disabled {
            background: #f0f0f0;
            border-color: #ccc;
            color: #999;
            cursor: not-allowed;
        }
        
        .page-numbers {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .page-number {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .page-number:hover {
            background: rgba(32, 116, 212, 0.1);
        }
        
        .page-number.active {
            background: #2074d4;
            color: #fff;
            border-color: #2074d4;
        }
    </style>
</head>

<body>
    <!-- Preloader -->
    <!-- <div class="preloader">
        <div class="loader">
            <div class="loader-outter"></div>
            <div class="loader-inner"></div>
            <div class="indicator">
                <svg width="16px" height="12px">
                    <polyline id="back" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                    <polyline id="front" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                </svg>
            </div>
        </div>
    </div> -->
    <!-- End Preloader -->

    <!-- Get Pro Button -->
    <ul class="pro-features">
        <a class="get-pro" href="#">Get Pro</a>
        <li class="big-title">Pro Version Available</li>
        <li class="title">Pro Version Features</li>
        <li>100+ chat history</li>
        <li>10 day free consulting sessions with real psychologist</li>
        <li>Access more news and tips everday</li>
        <li>Get no-ads forever</li>
    </ul>

    <!-- Header Area -->
    <header class="header">
        <!-- Header Inner -->
        <div class="header-inner">
            <div class="container">
                <div class="inner">
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-12">
                            <!-- Start Logo -->
                            <div class="logo">
                                <a href="index.html"><img src="images/logo_cbg.png" alt="Posy"></a>
                            </div>
                            <!-- End Logo -->
                            <!-- Mobile Nav -->
                            <div class="mobile-nav"></div>
                            <!-- End Mobile Nav -->
                        </div>
                        <div class="col-lg-7 col-md-9 col-12">
                            <!-- Main Menu -->
                            <div class="main-menu">
                                <nav class="navigation">
                                    <ul class="nav menu">
                                        <li><a href="index.html">Home</a></li>
                                        <li class="active">
                                            <a href="newsfeed.html">News</a>
                                        </li>
                                        <li><a href="chat.html">AI Chatbot</a></li>
                                        <li><a href="#">Help<i class="icofont-rounded-down"></i></a>
                                            <ul class="dropdown">
                                                <li>
                                                    <a href="portfolio-details.html">Services</a>
                                                    <a href="contact.html">Contact</a>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                            <!--/ End Main Menu -->
                        </div>
                        <div class="col-lg-2 col-12">
                            <div class="get-quote">
                                <a href="login.html" class="btn">Get Started</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/ End Header Inner -->
    </header>
    <!-- End Header Area -->

    <!-- News Feed Section -->
    <div class="container news-container">
        <h1 class="text-center mb-5">Latest News</h1>
        <div class="row">
            <!-- Left Column - Posts -->
            <div class="col-lg-8">
                <div id="postsContainer">
                    <div class="loading">Loading posts...</div>
                </div>
                <div class="pagination-container">
                    <button class="pagination-button" id="prevPage" disabled>Previous</button>
                    <div class="page-numbers" id="pageNumbers"></div>
                    <button class="pagination-button" id="nextPage" disabled>Next</button>
                </div>
            </div>

            <!-- Right Column -->
            <div class="col-lg-4">
                <!-- Search Box -->
                <div class="search-container">
                    <input type="text" class="search-input" placeholder="Search posts..." id="searchInput">
                    <button class="clear-search" id="clearSearch" disabled>Clear</button>
                    <div class="search-results" id="searchResults"></div>
                </div>

                <!-- Categories -->
                <div class="sidebar-box">
                    <h3>Categories</h3>
                    <ul class="category-list">
                        <li>Mental Health</li>
                        <li>Wellness</li>
                        <li>Self Care</li>
                        <li>Mindfulness</li>
                        <li>Anxiety & Depression</li>
                    </ul>
                </div>

                <!-- Recent Posts -->
                <div class="sidebar-box">
                    <h3>Recent Posts</h3>
                    <ul class="recent-post-list" id="recentPosts">
                        <!-- Recent posts will be dynamically inserted here -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer Area -->
    <footer id="footer" class="footer">
        <!-- Footer Top -->
        <div class="footer-top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer">
                            <h2>About Us</h2>
                            <p>Posy is a safe and supportive online space dedicated to promoting mental well-being. Explore our newsfeed, connect with our community, or chat with our AI companion.</p>
                            <!-- Social -->
                            <ul class="social">
                                <li><a href="#"><i class="icofont-facebook"></i></a></li>
                                <li><a href="#"><i class="icofont-google-plus"></i></a></li>
                                <li><a href="#"><i class="icofont-twitter"></i></a></li>
                                <li><a href="#"><i class="icofont-vimeo"></i></a></li>
                                <li><a href="#"><i class="icofont-pinterest"></i></a></li>
                            </ul>
                            <!-- End Social -->
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer f-link">
                            <h2>Quick Links</h2>
                            <div class="row">
                                <div class="col-lg-6 col-md-6 col-12">
                                    <ul>
                                        <li><a href="index.html"><i class="fa fa-caret-right" aria-hidden="true"></i>Home</a></li>
                                        <li><a href="blog-single.html"><i class="fa fa-caret-right" aria-hidden="true"></i>News</a></li>
                                        <li><a href="chat.html"><i class="fa fa-caret-right" aria-hidden="true"></i>AI chatbot</a></li>
                                        <li><a href="portfolio-details.html"><i class="fa fa-caret-right" aria-hidden="true"></i>Services</a></li>
                                        <li><a href="contact.html"><i class="fa fa-caret-right" aria-hidden="true"></i>Contact Us</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer">
                            <h2>Newsletter</h2>
                            <p>Subscribe to our newsletter to get informed news in your inbox & highlight our recent blog post or article on a specific mental health topic</p>
                            <form action="mail/mail.php" method="get" target="_blank" class="newsletter-inner">
                                <input name="email" placeholder="Email Address" class="common-input" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Your email address'" required="" type="email">
                                <button class="button"><i class="icofont icofont-paper-plane"></i></button>
                            </form>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6 col-12">
                        <div class="single-footer">
                            <h2>Contact Us</h2>
                            <ul class="top-contact" style="color: white;">
                                <li><i class="fa fa-phone"></i>+89 123 456 789</li>
                                <li><i class="fa fa-envelope"></i><a href="mailto:support@posy.com"> support@posy.com.vn</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/ End Footer Top -->
        <!-- Copyright -->
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-12">
                        <div class="copyright-content">
                            <p>© Copyright 2024 | All Rights Reserved by Xuan Nguyen</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/ End Copyright -->
    </footer>
    <!--/ End Footer Area -->

    <!-- Essential Scripts -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.0.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/slicknav.min.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="post_apis.js"></script>
    <script>
        // Configure marked to decrease heading levels
        const renderer = new marked.Renderer();
        renderer.heading = function(text, level) {
            // Decrease heading level by 2 (h1->h3, h2->h4, etc)
            level = text.depth;
            text = text.text;
            const newLevel = Math.min(level + 4, 6); // Ensure we don't exceed h6
            console.log('newLevel:', newLevel);
            console.log('text:', text);
            return `<h${newLevel}>${text}</h${newLevel}>`;
        };
        marked.setOptions({ renderer });
    </script>
    <script>
        // Initialize mobile navigation and scroll to top
        $(document).ready(function() {
            $('.mobile-nav').slicknav({
                prependTo: '.mobile-nav',
                duration: 300,
                closeOnClick: true
            });

            $.scrollUp({
                scrollName: 'scrollUp',
                scrollDistance: 300,
                scrollFrom: 'top',
                scrollSpeed: 300,
                easingType: 'linear',
                animation: 'fade',
                animationSpeed: 200,
                scrollTrigger: false,
                scrollText: ["<i class='fa fa-angle-up'></i>"],
                scrollTitle: false,
                scrollImg: false,
                activeOverlay: false,
                zIndex: 2147483647
            });

            // Pagination variables
            let currentPage = 1;
            let postsPerPage = 5;
            let totalPages = 1;

            // Load and display posts
            loadPosts();

            // Pagination event listeners
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayPosts(currentSearchResults || allPosts);
                }
            });

            document.getElementById('nextPage').addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayPosts(currentSearchResults || allPosts);
                }
            });

            // Setup search functionality
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            const clearSearchBtn = document.getElementById('clearSearch');
            let allPosts = [];
            let currentSearchResults = null;

            // Enable/disable clear button based on search input
            searchInput.addEventListener('input', function() {
                clearSearchBtn.disabled = !this.value.trim();
            });

            // Clear search handler
            clearSearchBtn.addEventListener('click', function() {
                searchInput.value = '';
                clearSearchBtn.disabled = true;
                currentSearchResults = null;
                displayPosts(allPosts);
                searchResults.classList.remove('active');
            });

            let searchTimeout;
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.trim();

                // Clear previous timeout
                clearTimeout(searchTimeout);

                if (searchTerm.length > 0) {
                    // Add loading indicator
                    searchResults.innerHTML = '<div class="search-result-item">Searching...</div>';
                    searchResults.classList.add('active');

                    // Debounce search requests
                    searchTimeout = setTimeout(async() => {
                        try {
                            const results = await searchPosts(searchTerm);
                            displaySearchResults(results);
                        } catch (error) {
                            console.error('Search error:', error);
                            searchResults.innerHTML = '<div class="search-result-item">Error searching posts</div>';
                        }
                    }, 300); // Wait 300ms after user stops typing
                } else {
                    searchResults.classList.remove('active');
                }
            });

            // Handle Enter key press
            searchInput.addEventListener('keydown', async function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    const searchTerm = this.value.trim();

                    if (searchTerm) {
                        try {
                            const results = await searchPosts(searchTerm);
                            currentSearchResults = results;
                            displayPosts(results);
                            searchResults.classList.remove('active');
                        } catch (error) {
                            console.error('Search error:', error);
                            displayError('Search Error', 'Failed to search posts. Please try again.');
                        }
                    } else {
                        // If search is cleared, show all posts
                        currentSearchResults = null;
                        displayPosts(allPosts);
                    }
                }
            });

            // Close search results when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchResults.contains(e.target) && e.target !== searchInput) {
                    searchResults.classList.remove('active');
                }
            });

            async function loadPosts() {
                try {
                    allPosts = await getPosts();
                    if (allPosts && allPosts.length > 0) {
                        displayPosts(allPosts);
                        updateRecentPosts(allPosts);
                    } else {
                        displayError("No posts available", "Create some posts to see them here");
                    }
                } catch (error) {
                    console.error('Error loading posts:', error);
                    if (error.message.includes('Failed to fetch')) {
                        displayError(
                            "Cannot connect to server",
                            "Please make sure the backend server is running at http://localhost:8000"
                        );
                    } else {
                        displayError("Error loading posts", "Please try again later");
                    }
                }
            }

            function displayError(title, message) {
                document.getElementById('postsContainer').innerHTML = `
                    <div class="error-message">
                        <h3>${title}</h3>
                        <p>${message}</p>
                    </div>
                `;
                document.getElementById('recentPosts').innerHTML = `
                    <li>No recent posts available</li>
                `;
            }

            function displayPosts(posts) {
                const postsContainer = document.getElementById('postsContainer');
                const isSearchResult = currentSearchResults !== null;

                if (posts.length === 0) {
                    displayError(
                        isSearchResult ? "No matching posts found" : "No posts available",
                        isSearchResult ? "Try a different search term" : "Check back later for new content"
                    );
                    return;
                }

                // Update recent posts only when showing all posts
                if (!isSearchResult) {
                    updateRecentPosts(posts);
                }

                // Calculate pagination
                totalPages = Math.ceil(posts.length / postsPerPage);
                updatePaginationControls();

                // Get current page posts
                const startIndex = (currentPage - 1) * postsPerPage;
                const endIndex = startIndex + postsPerPage;
                const currentPosts = posts.slice(startIndex, endIndex);

                // Display featured post (first post of current page)
                const featuredPost = currentPosts[0];
                let html = `
                    <div class="article-card featured-post" data-post-id="${featuredPost._id}" onclick="window.location.href='blog-single.html?id=${featuredPost._id}'">
                        <img src="${featuredPost.imageUrl || 'images/news_feature.png'}" alt="${featuredPost.title}" class="article-image">
                        <div class="article-content">
                            <h2>${featuredPost.title}</h2>
                            <div class="article-meta">
                                By ${featuredPost.author} | ${new Date(featuredPost.createdAt).toLocaleDateString()}
                            </div>
                            <div class="article-text">
                                ${marked.parse(featuredPost.content)}
                            </div>
                        </div>
                    </div>
                `;

                // Display remaining posts in grid
                if (currentPosts.length > 1) {
                    html += '<div class="posts-grid">';
                    currentPosts.slice(1).forEach(post => {
                        html += `
                            <div class="article-card" data-post-id="${post._id}" onclick="window.location.href='blog-single.html?id=${post._id}'">
                                <img src="${post.imageUrl || 'images/news_feature.png'}" alt="${post.title}" class="article-image">
                                <div class="article-content">
                                    <h2>${post.title}</h2>
                                    <div class="article-meta">
                                        By ${post.author} | ${new Date(post.createdAt).toLocaleDateString()}
                                    </div>
                                    <div class="article-text">
                                        ${marked.parse(post.content)}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }

                function updatePaginationControls() {
                    const prevButton = document.getElementById('prevPage');
                    const nextButton = document.getElementById('nextPage');
                    const pageNumbersContainer = document.getElementById('pageNumbers');

                    // Update prev/next buttons
                    prevButton.disabled = currentPage === 1;
                    nextButton.disabled = currentPage === totalPages;

                    // Update page numbers
                    let pageNumbersHtml = '';
                    for (let i = 1; i <= totalPages; i++) {
                        pageNumbersHtml += `
                        <span class="page-number ${i === currentPage ? 'active' : ''}" 
                              onclick="changePage(${i})">
                            ${i}
                        </span>
                    `;
                    }
                    pageNumbersContainer.innerHTML = pageNumbersHtml;
                }

                // Global function for page number clicks
                window.changePage = function(pageNumber) {
                    currentPage = pageNumber;
                    displayPosts(currentSearchResults || allPosts);
                }

                postsContainer.innerHTML = html;
            }

            function displaySearchResults(posts) {
                if (!Array.isArray(posts) || posts.length === 0) {
                    searchResults.innerHTML = '<div class="search-result-item">No matching posts found</div>';
                    return;
                }

                searchResults.innerHTML = posts.map(post => `
                    <div class="search-result-item" onclick="scrollToPost('${post._id}')">
                        <div class="search-result-title">${post.title}</div>
                        <div class="search-result-meta">
                            By ${post.author} | ${new Date(post.createdAt).toLocaleDateString()}
                        </div>
                    </div>
                `).join('');
            }

            function updateRecentPosts(posts) {
                const recentPostsList = document.getElementById('recentPosts');
                const recentPosts = posts.slice(0, 5); // Show 5 most recent posts

                recentPostsList.innerHTML = recentPosts.map(post => `
                    <li onclick="scrollToPost('${post._id}')" style="cursor: pointer" data-post-id="${post._id}">
                        ${post.title}
                    </li>
                `).join('');
            }
        });

        function scrollToPost(postId) {
            const postElement = document.querySelector(`[data-post-id="${postId}"]`);
            if (postElement) {
                postElement.scrollIntoView({
                    behavior: 'smooth'
                });
                document.getElementById('searchResults').classList.remove('active');
            }
        }
    </script>
</body>

</html>
