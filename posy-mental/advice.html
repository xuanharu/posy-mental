<!doctype html>
<html class="no-js" lang="zxx">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Posy - Mental Health Advice</title>
    <link rel="icon" href="img/favicon.png">
    <link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/nice-select.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/icofont.css">
    <link rel="stylesheet" href="css/slicknav.min.css">
    <link rel="stylesheet" href="css/owl-carousel.css">
    <link rel="stylesheet" href="css/datepicker.css">
    <link rel="stylesheet" href="css/animate.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive.css">

    <style>
        .tag-section {
            margin-bottom: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .tag-section h3 {
            color: #2074d4;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .tag {
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid #2074d4;
            background: white;
            color: #2074d4;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tag:hover {
            background: #e8f0fe;
        }
        
        .tag.selected {
            background: #2074d4;
            color: white;
        }
        
        .submit-btn {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 12px 24px;
            background: #2074d4;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background: #1b5eb8;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }
        
        .questions-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .questions-section.visible {
            display: block;
        }
        
        .question {
            margin-bottom: 30px;
            padding: 20px;
            border-left: 4px solid #2074d4;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
        }
        
        .advice-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #fff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .advice-section.visible {
            display: block;
        }
        
        .advice-summary {
            font-size: 1.1em;
            line-height: 1.6;
            color: #333;
            margin-bottom: 20px;
            padding: 15px;
            background: #e8f0fe;
            border-radius: 8px;
        }
        
        .advice-recommendations {
            margin-bottom: 20px;
        }
        
        .recommendation-item {
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-left: 3px solid #2074d4;
            border-radius: 0 4px 4px 0;
        }
        
        .resources-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .resource-link {
            padding: 10px 15px;
            background: #2074d4;
            color: white;
            border-radius: 20px;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .resource-link:hover {
            background: #1b5eb8;
            transform: translateY(-2px);
        }
        
        .next-steps {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        
        .next-steps h4 {
            color: #2074d4;
            margin-bottom: 10px;
        }
        
        .next-steps ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .next-steps li {
            padding: 5px 0;
            position: relative;
            padding-left: 20px;
        }
        
        .next-steps li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #2074d4;
        }
        
        .question-text {
            font-size: 1.1em;
            font-weight: 500;
            margin-bottom: 15px;
            color: #333;
        }
        
        .options-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .option-item:hover {
            background: #e8f0fe;
        }
        
        .option-item input[type="radio"] {
            margin-right: 10px;
        }
        
        .option-item label {
            cursor: pointer;
            flex: 1;
            margin: 0;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .loading.visible {
            display: block;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            margin: 0 auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2074d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- Header Area -->
    <header class="header">
        <div class="header-inner">
            <div class="container">
                <div class="inner">
                    <div class="row">
                        <div class="col-lg-3 col-md-3 col-12">
                            <div class="logo">
                                <a href="index.html"><img src="images/logo_cbg.png" alt="Posy"></a>
                            </div>
                            <div class="mobile-nav"></div>
                        </div>
                        <div class="col-lg-7 col-md-9 col-12">
                        </div>
                        <div class="col-lg-2 col-12">
                            <div class="get-quote">
                                <a href="login.html" class="btn">Get Started</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- End Header Area -->

    <!-- Start Advice Section -->
    <section class="section">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="section-title">
                        <h2>Mental Health Self-Assessment</h2>
                        <p>Select the tags that best describe your current situation or concerns. We'll generate personalized questions to help you reflect on your mental health journey.</p>
                    </div>
                </div>
            </div>

            <div class="tag-section">
                <h3>Mental Health</h3>
                <div class="tag-container" id="mental-health-tags">
                    <button class="tag" onclick="toggleTag(this)">Addiction</button>
                    <button class="tag" onclick="toggleTag(this)">Anxiety</button>
                    <button class="tag" onclick="toggleTag(this)">ADHD</button>
                    <button class="tag" onclick="toggleTag(this)">Asperger's</button>
                    <button class="tag" onclick="toggleTag(this)">Autism</button>
                    <button class="tag" onclick="toggleTag(this)">Bipolar Disorder</button>
                    <button class="tag" onclick="toggleTag(this)">Chronic Pain</button>
                    <button class="tag" onclick="toggleTag(this)">Depression</button>
                    <button class="tag" onclick="toggleTag(this)">Eating Disorders</button>
                </div>

                <h3>Personality</h3>
                <div class="tag-container" id="personality-tags">
                    <button class="tag" onclick="toggleTag(this)">Passive Aggression</button>
                    <button class="tag" onclick="toggleTag(this)">Personality</button>
                    <button class="tag" onclick="toggleTag(this)">Shyness</button>
                </div>

                <h3>Personal Growth</h3>
                <div class="tag-container" id="growth-tags">
                    <button class="tag" onclick="toggleTag(this)">Goal Setting</button>
                    <button class="tag" onclick="toggleTag(this)">Happiness</button>
                    <button class="tag" onclick="toggleTag(this)">Positive Psychology</button>
                    <button class="tag" onclick="toggleTag(this)">Stopping Smoking</button>
                </div>

                <h3>Relationship</h3>
                <div class="tag-container" id="relationship-tags">
                    <button class="tag" onclick="toggleTag(this)">Low Sexual Desire</button>
                    <button class="tag" onclick="toggleTag(this)">Relationships</button>
                    <button class="tag" onclick="toggleTag(this)">Sex</button>
                    <button class="tag" onclick="toggleTag(this)">Family Life</button>
                    <button class="tag" onclick="toggleTag(this)">Child Development</button>
                    <button class="tag" onclick="toggleTag(this)">Parenting</button>
                </div>
            </div>

            <button class="submit-btn" onclick="generateQuestions()">Generate Questions</button>

            <div class="loading">
                <div class="spinner"></div>
                <p>Generating personalized questions...</p>
            </div>

            <div class="questions-section" id="questions-section">
                <h3>Your Personalized Questions</h3>
                <div id="questions-container">
                    <!-- Questions will be inserted here -->
                </div>
                <button class="submit-btn" onclick="submitAnswers()" style="margin-top: 30px;">Get Personalized Advice</button>
            </div>

            <div class="advice-section" id="advice-section">
                <h3>Your Personalized Advice</h3>
                <div id="advice-container">
                    <!-- Advice will be inserted here -->
                </div>
            </div>
        </div>
    </section>
    <!-- End Advice Section -->

    <!-- jquery Min JS -->
    <script src="js/jquery.min.js"></script>
    <script src="js/jquery-migrate-3.0.0.js"></script>
    <script src="js/jquery-ui.min.js"></script>
    <script src="js/easing.js"></script>
    <script src="js/colors.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap-datepicker.js"></script>
    <script src="js/jquery.nav.js"></script>
    <script src="js/slicknav.min.js"></script>
    <script src="js/jquery.scrollUp.min.js"></script>
    <script src="js/niceselect.js"></script>
    <script src="js/tilt.jquery.min.js"></script>
    <script src="js/owl-carousel.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/steller.js"></script>
    <script src="js/wow.min.js"></script>
    <script src="js/jquery.magnific-popup.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/waypoints/2.0.3/waypoints.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>

    <script>
        function toggleTag(element) {
            element.classList.toggle('selected');
        }

        async function collectAnswers() {
            const answers = [];
            const questions = document.querySelectorAll('.question');

            for (let i = 0; i < questions.length; i++) {
                const selectedOption = questions[i].querySelector('input[type="radio"]:checked');
                if (!selectedOption) {
                    return null; // Return null if any question is unanswered
                }
                answers.push({
                    question: questions[i].querySelector('.question-text').textContent,
                    answer: selectedOption.value
                });
            }

            return answers;
        }

        async function submitAnswers() {
            const answers = await collectAnswers();
            if (!answers) {
                alert('Please answer all questions before submitting');
                return;
            }

            const selectedTags = Array.from(document.querySelectorAll('.tag.selected'))
                .map(tag => tag.textContent);

            document.querySelector('.loading').classList.add('visible');
            document.querySelector('.advice-section').classList.remove('visible');

            try {
                const response = await fetch('http://localhost:8000/mental-health/generate-advice', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        answers: answers,
                        tags: selectedTags
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate advice');
                }

                const advice = await response.json();
                displayAdvice(advice);
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to generate advice. Please try again.');
            } finally {
                document.querySelector('.loading').classList.remove('visible');
            }
        }

        function displayAdvice(advice) {
            const adviceContainer = document.getElementById('advice-container');
            adviceContainer.innerHTML = `
                <div class="advice-summary">${advice.summary}</div>
                
                <div class="advice-recommendations">
                    <h4>Recommendations</h4>
                    ${advice.recommendations.map(rec => `
                        <div class="recommendation-item">${rec}</div>
                    `).join('')}
                </div>

                <div class="resources">
                    <h4>Helpful Resources</h4>
                    <div class="resources-list">
                        ${advice.resources.map(resource => `
                            <a href="${resource.url}" target="_blank" class="resource-link">${resource.name}</a>
                        `).join('')}
                    </div>
                </div>

                <div class="next-steps">
                    <h4>Next Steps</h4>
                    <ul>
                        ${advice.next_steps.map(step => `
                            <li>${step}</li>
                        `).join('')}
                    </ul>
                </div>
            `;

            document.querySelector('.advice-section').classList.add('visible');
            document.querySelector('.advice-section').scrollIntoView({ behavior: 'smooth' });
        }

        async function generateQuestions() {
            const selectedTags = Array.from(document.querySelectorAll('.tag.selected'))
                .map(tag => tag.textContent);

            if (selectedTags.length === 0) {
                alert('Please select at least one tag');
                return;
            }

            // Show loading spinner
            document.querySelector('.loading').classList.add('visible');
            document.querySelector('.questions-section').classList.remove('visible');

            try {
                // Call your backend API to generate questions
                const response = await fetch('http://localhost:8000/mental-health/generate-questions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        tags: selectedTags
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate questions');
                }

                const data = await response.json();

                // Display the questions
                const questionsContainer = document.getElementById('questions-container');
                questionsContainer.innerHTML = data.questions
                    .map((q, qIndex) => `
                        <div class="question">
                            <div class="question-text">${q.question}</div>
                            <div class="options-list">
                                ${q.options.map((option, oIndex) => `
                                    <div class="option-item">
                                        <input type="radio" 
                                               id="q${qIndex}_o${oIndex}" 
                                               name="question${qIndex}" 
                                               value="${option}">
                                        <label for="q${qIndex}_o${oIndex}">${option}</label>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('');

                // Show questions section
                document.querySelector('.questions-section').classList.add('visible');
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to generate questions. Please try again.');
            } finally {
                // Hide loading spinner
                document.querySelector('.loading').classList.remove('visible');
            }
        }
    </script>
</body>

</html>